<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fear Theme â€“ Simple Replayable</title>
    <style>
        body.theme-active {
            margin: 0;
            height: 100vh;
            overflow: hidden;
            background: radial-gradient(circle at center, #0a0f21, #000);
        }

        #theme-animation-container {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 9999;
            overflow: hidden;
        }

        .fog {
            position: absolute;
            width: 150%;
            height: 150%;
            background: url("https://i.ytimg.com/vi/GYa5IcAoo08/maxresdefault.jpg") no-repeat center/cover;
            opacity: 0.6;
            animation: fogMove 20s linear infinite alternate;
        }

        @keyframes fogMove {
            0% { transform: translate(-20%, -10%) scale(1.2); }
            100% { transform: translate(-10%, -20%) scale(1.4); }
        }

        .ghost {
            position: absolute;
            font-size: 40px;
            opacity: 0;
            pointer-events: none;
            animation: ghostMove 8s linear forwards;
        }

        @keyframes ghostMove {
            0% { opacity: 0; transform: translate(var(--startX), var(--startY)) scale(0.5); }
            20% { opacity: 0.8; }
            80% { opacity: 0.8; }
            100% { opacity: 0; transform: translate(var(--endX), var(--endY)) scale(1); }
        }

        .spark {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #b3eafe;
            border-radius: 50%;
            opacity: 0.8;
            animation: sparkMove 3s linear forwards;
        }

        @keyframes sparkMove {
            0% { transform: translateY(100vh); opacity: 0; }
            20% { opacity: 1; }
            100% { transform: translateY(-120vh); opacity: 0; }
        }
    </style>
</head>

<body>
    <div id="theme-animation-container"></div>

    <script>
        // Use a persistent global variable for intervals
        window.__fearThemeIntervals = window.__fearThemeIntervals || [];

        function startTheme() {
            // STOP previous runs first to prevent double-stacking
            stopTheme();

            document.body.classList.add("theme-active");

            // *** FIX: Define container INSIDE the function so it grabs the fresh HTML element ***
            const container = document.getElementById("theme-animation-container");
            const fearEmojis = ["ðŸ˜±", "ðŸ‘»", "ðŸ‘€", "ðŸ˜¨", "ðŸ•·ï¸", "ðŸ˜°"];

            // Add fog
            const fog = document.createElement("div");
            fog.className = "fog";
            container.appendChild(fog);

            // Ghost Function
            function ghost() {
                // Check if container still exists to prevent errors if theme stopped mid-animation
                if (!document.getElementById("theme-animation-container")) return;

                const g = document.createElement("div");
                g.className = "ghost";
                g.textContent = fearEmojis[Math.floor(Math.random() * fearEmojis.length)];
                
                g.style.setProperty("--startX", Math.random() > 0.5 ? "-10vw" : "110vw");
                g.style.setProperty("--endX", Math.random() > 0.5 ? "110vw" : "-10vw");
                g.style.setProperty("--startY", Math.random() * 80 + "vh");
                g.style.setProperty("--endY", Math.random() * 80 + "vh");
                g.style.animationDuration = (6 + Math.random() * 4) + "s";
                
                container.appendChild(g);
                setTimeout(() => g.remove(), 10000);
            }

            // Spark Function
            function spark() {
                if (!document.getElementById("theme-animation-container")) return;

                const s = document.createElement("div");
                s.className = "spark";
                s.style.left = Math.random() * 100 + "vw";
                s.style.animationDuration = (2 + Math.random() * 2) + "s";
                container.appendChild(s);
                setTimeout(() => s.remove(), 4000);
            }

            // Start Intervals
            window.__fearThemeIntervals.push(setInterval(ghost, 1500));
            window.__fearThemeIntervals.push(setInterval(spark, 400));

            // Initial spawn
            for (let i = 0; i < 5; i++) setTimeout(ghost, i * 300);
        }

        function stopTheme() {
            // Clear Intervals
            if (window.__fearThemeIntervals) {
                window.__fearThemeIntervals.forEach(i => clearInterval(i));
                window.__fearThemeIntervals = [];
            }

            // *** FIX: Get container afresh here too ***
            const container = document.getElementById("theme-animation-container");
            if (container) {
                container.innerHTML = "";
            }
            document.body.classList.remove("theme-active");
        }

        // Uncomment for testing auto-start:
        // startTheme();
    </script>
</body>
</html>